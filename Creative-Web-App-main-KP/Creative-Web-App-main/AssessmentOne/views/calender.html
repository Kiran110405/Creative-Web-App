<!DOCTYPE html>
<html lang='en'>

<head>
    <meta charset='utf-8' />
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.19/index.global.min.js'></script>
    <link rel="stylesheet" href="EveryPage.css">
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            var calendarEl = document.getElementById('calendar');

            var calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                selectable: true,
                selectMirror: true,

                dateClick: async function (info) {
                    let title = prompt("Enter title of deadline");
                    let detail = prompt("Enter detail")
                    if (!title) return;

                    // Getting the logged in user 
                    const userId = localStorage.getItem("loggedInUser");

                    // Save to MongoDB
                    const response = await fetch("/api/events", {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ userId, title, detail, date: info.dateStr })
                    });

                    const saved = await response.json();

                    // Show event on calendar
                    calendar.addEvent({
                        id: saved.event._id,
                        title: title,
                        detail: detail,
                        start: info.dateStr,
                        allDay: true
                    });
                },

                // âœ… MOVED HERE (inside calendar config)
                eventClick: async function (info) {
                    if (!confirm(`You wish to DELETE event: "${info.event.title}"?`)) return;

                    const eventId = info.event.id;

                    // Delete in backend
                    await fetch(`/api/events/${eventId}`, {
                        method: "DELETE"
                    });

                    // Remove from UI
                    info.event.remove();
                }
            });

            // Load events from MongoDB when page opens
            const userId = localStorage.getItem("loggedInUser");

            fetch(`/api/events/${userId}`)
                .then(res => res.json())
                .then(events => {
                    events.forEach(ev => {
                        calendar.addEvent({
                            id: ev._id,
                            title: ev.title,
                            detail: ev.detail,
                            start: ev.date,
                            allDay: true
                        });
                    });
                });

            calendar.render();
        });

        // document.addEventListener('DOMContentLoaded', function () {
        // var calendarEl = document.getElementById('calendar');

        // var calendar = new FullCalendar.Calendar(calendarEl, {
        // initialView: 'dayGridMonth',
        // selectable: true,
        // selectMirror: true,

        // dateClick: async function (info) {
        // let title = prompt("Enter event title:")
        // if (!title) return;

        // //getting the logged in user
        // const userId = localStorage.getItem("loggedInUser");

        // //save the event to mongoDB
        // const response = await fetch("/api/events", {
        // method: "POST",
        // headers: { "Content-Type": "application/json" },
        // body: JSON.stringify({ userId, title, date: info.dateStr })
        // })

        // const saved = await response.json();

        // //Also show the event on UI
        // calender.addEvent({
        // id: saved.event._id,
        // title: title,
        // start: info.dateStr,
        // allDay: true,
        // })
        // }


        // // dateClick: async function (info) {
        // // let title = prompt("Enter event title:");
        // // if (!title) return;

        // // const userId = localStorage.getItem("loggedInUser");

        // // const response = await fetch("/api/events", {
        // // method: "POST",
        // // headers: { "Content-Type": "application/json" },
        // // body: JSON.stringify({
        // // userId,
        // // title,
        // // date: info.dateStr
        // // })
        // // });

        // // const saved = await response.json();

        // // calendar.addEvent({
        // // id: saved.event._id,
        // // title,
        // // start: info.dateStr,
        // // allDay: true
        // // });
        // // },


        // eventClick: async function (info) {
        // if (!confirm(`Delete event: "${info.event.title}"?`)) return;

        // await fetch(`/api/events/${info.event.id}`, {
        // method: "DELETE"
        // });

        // info.event.remove();
        // }
        // });


        // calendar.render();
        // });

    </script>



</head>

<body>
    <header>
        <div class="keyboard">
            <span class="key">F</span>
            <span class="key">O</span>
            <span class="key">C</span>
            <span class="key">U</span>
            <span class="key">S</span>
            <span class="key">H</span>
            <span class="key">U</span>
            <span class="key">B</span>
        </div>
    </header>
    <nav id="navbar">
        <ul class="ul"><a class="navtext" href="homepage">Home</a></ul>
        <ul class="ul"><a class="navtext" href="map">Map</a></ul>
        <ul class="ul"><a class="navtext" href="AI">AI assistant</a></ul>
        <ul class="ul"><a class="navtext" href="calender">Calender</a></ul>
        <ul class="ul"><a class="navtext" href="notes">Notes</a></ul>

        <ul class="ul"><a class="navtext" href="logout">Logout</a></ul>

    </nav>
    <div id='calendar'></div>
</body>

</html>