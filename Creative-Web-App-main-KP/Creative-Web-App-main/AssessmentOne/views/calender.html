<!DOCTYPE html>
<html lang='en'>

<head>
    <meta charset='utf-8' />
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.19/index.global.min.js'></script>
    <link rel="stylesheet" href="EveryPage.css">
    <link rel="stylesheet" href="calender.css">
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            var calendarEl = document.getElementById('calendar');

            var calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                selectable: true,
                selectMirror: true,

                dateClick: async function (info) {
                    let title = prompt("Enter title of deadline");
                    let detail = prompt("Enter detail")
                    if (!title) return;

                    // Getting the logged in user 
                    const userId = localStorage.getItem("loggedInUser");

                    // Save to MongoDB
                    const response = await fetch("/api/events", {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ userId, title, detail, date: info.dateStr })
                    });

                    const saved = await response.json();

                    // Show event on calendar
                    calendar.addEvent({
                        id: saved.event._id,
                        title: title,
                        detail: detail,
                        start: info.dateStr,
                        allDay: true
                    });
                },

                //when date is clicked again
                eventClick: async function (info) {
                    if (!confirm(`You wish to DELETE event: "${info.event.title}"?`)) return;

                    const eventId = info.event.id;

                    await fetch(`/api/events/${eventId}`, {
                        method: "DELETE"
                    });

                    // Remove from UI
                    info.event.remove();
                }
            });

            // Load events from MongoDB when page opens
            const userId = localStorage.getItem("loggedInUser");

            fetch(`/api/events/${userId}`)
                .then(res => res.json())
                .then(events => {
                    events.forEach(ev => {
                        calendar.addEvent({
                            id: ev._id,
                            title: ev.title,
                            detail: ev.detail,
                            start: ev.date,
                            allDay: true
                        });
                    });
                });

            calendar.render();
        });
    </script>



</head>

<body>
    <header>
        <div class="keyboard">
            <span class="key">F</span>
            <span class="key">O</span>
            <span class="key">C</span>
            <span class="key">U</span>
            <span class="key">S</span>
            <span class="key">H</span>
            <span class="key">U</span>
            <span class="key">B</span>
        </div>
    </header>
    <nav id="navbar">
        <ul class="ul"><a class="navtext" href="homepage">Home</a></ul>
        <ul class="ul"><a class="navtext" href="map">Map</a></ul>
        <ul class="ul"><a class="navtext" href="AI">AI assistant</a></ul>
        <ul class="ul"><a class="navtext" href="calender">Calender</a></ul>
        <ul class="ul"><a class="navtext" href="notes">Notes</a></ul>

        <ul class="ul"><a class="navtext" href="logout">Logout</a></ul>

    </nav>
    <main>
        <h2>CALENDER</h2>
        <div id="text">
            <p>Our built-in calendar feature is designed to help you stay organised and in control of your schedule. You
                can easily add important deadlines, set specific times for revision, and plan study sessions that fit
                around your day. Once added, everything is saved directly to your calendar so you can come back and
                review your plans at any time. By visually laying out your tasks and goals, the calendar helps you
                manage your time more effectively and avoid last-minute stress. You’ll receive a clear overview of
                what’s coming up, what needs attention, and when to focus. Whether you’re tracking assignments, exams,
                or personal goals, this feature keeps everything in one place and helps you stay consistent, motivated,
                and on track with what matters most.</p>
        </div>
        <div id='calendar'></div>
    </main>
</body>

</html>